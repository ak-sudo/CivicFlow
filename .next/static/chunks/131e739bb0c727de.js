(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,42584,e=>{"use strict";let t=(0,e.i(68385).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],42584)},9803,e=>{"use strict";let t=(0,e.i(68385).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],9803)},31161,e=>{"use strict";let t=(0,e.i(68385).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],31161)},14471,e=>{"use strict";let t="civicflow_user_profile";function a(){try{let e=localStorage.getItem(t);return e?JSON.parse(e):null}catch{return null}}function r(e){try{localStorage.setItem(t,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("profileUpdated",{detail:{profile:e}}))}catch(e){console.error("Failed to save profile to localStorage:",e)}}function i(){let e={id:"user_"+Date.now(),full_name:"Amit Verma",email:"amit.verma@example.com",phone:"+91 98765 43210",address:"Connaught Place, New Delhi, Delhi 110001",role:"citizen",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},t=a();return t||r(e),t||e}e.s(["getProfileFromStorage",()=>a,"initializeDefaultProfile",()=>i,"saveProfileToStorage",()=>r])},2436,59317,e=>{"use strict";var t=e.i(51537),a=e.i(43638),r=e.i(80486),i=e.i(32749),n=e.i(87672),s=e.i(3305),o=e.i(3908),c=e.i(14782),l=e.i(9704),d=e.i(73183),m=e.i(16221),u=e.i(58987);let h="civicflow_worker_notifications";function x(e){try{let t=localStorage.getItem(h);return(t?JSON.parse(t):[]).filter(t=>t.worker_id===e).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())}catch{return[]}}function g(e){try{let t=localStorage.getItem(h),a=(t?JSON.parse(t):[]).map(t=>t.id===e?{...t,is_read:!0}:t);localStorage.setItem(h,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("workerNotificationUpdated"))}catch(e){console.error("Failed to mark notification as read:",e)}}function f(e){try{let t=localStorage.getItem(h),a=(t?JSON.parse(t):[]).filter(t=>t.id!==e);localStorage.setItem(h,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("workerNotificationUpdated"))}catch(e){console.error("Failed to delete notification:",e)}}function p(e){try{let t=localStorage.getItem(h),a=(t?JSON.parse(t):[]).map(t=>t.worker_id===e?{...t,is_read:!0}:t);localStorage.setItem(h,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("workerNotificationUpdated"))}catch(e){console.error("Failed to mark all notifications as read:",e)}}function w(e){return x(e).filter(e=>!e.is_read).length}e.s(["deleteWorkerNotification",()=>f,"getUnreadWorkerNotificationCount",()=>w,"getWorkerNotifications",()=>x,"markAllWorkerNotificationsAsRead",()=>p,"markWorkerNotificationAsRead",()=>g],59317);var j=e.i(14471),N=e.i(22869);function k({userName:e}){let h=(0,m.useRouter)(),[x,g]=(0,u.useState)(0),f=(0,j.getProfileFromStorage)(),p=f?.id||"worker_default";(0,u.useEffect)(()=>{let e=()=>{g(w(p))};return e(),window.addEventListener("workerNotificationAdded",e),window.addEventListener("workerNotificationUpdated",e),()=>{window.removeEventListener("workerNotificationAdded",e),window.removeEventListener("workerNotificationUpdated",e)}},[p]);let k=async()=>{let e=(0,d.createClient)();await e.auth.signOut(),h.push("/")};return(0,t.jsx)("header",{className:"sticky top-0 z-40 border-b border-border bg-background",children:(0,t.jsxs)("div",{className:"flex h-16 items-center justify-between px-4 md:px-6",children:[(0,t.jsxs)(a.default,{href:"/citizen/dashboard",className:"flex items-center gap-2",children:[(0,t.jsx)(o.default,{src:"/civiflow-logo.png",alt:"CivicFlow Logo",width:36,height:36,className:"object-contain"}),(0,t.jsx)("span",{className:"text-xl font-bold hidden sm:inline",children:"CivicFlow"})]}),(0,t.jsxs)("nav",{className:"flex items-center gap-6",children:[(0,t.jsx)(a.default,{href:"/worker/dashboard",className:"text-sm font-medium hover:text-primary transition-colors",children:"Dashboard"}),(0,t.jsx)(a.default,{href:"/worker/tasks",className:"text-sm font-medium hover:text-primary transition-colors",children:"My Tasks"}),(0,t.jsx)(a.default,{href:"/worker/attendance",className:"text-sm font-medium hover:text-primary transition-colors",children:"Attendance"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",className:"relative",asChild:!0,children:(0,t.jsxs)(a.default,{href:"/worker/notifications",children:[(0,t.jsx)(i.Bell,{className:"h-5 w-5"}),x>0&&(0,t.jsx)(l.Badge,{className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:x})]})}),(0,t.jsxs)(c.DropdownMenu,{children:[(0,t.jsx)(c.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(n.User,{className:"h-5 w-5"})})}),(0,t.jsxs)(c.DropdownMenuContent,{align:"end",className:"w-56",children:[(0,t.jsx)(c.DropdownMenuLabel,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Worker Account"})]})}),(0,t.jsx)(c.DropdownMenuSeparator,{}),(0,t.jsx)(c.DropdownMenuItem,{asChild:!0,children:(0,t.jsx)(a.default,{href:"/worker/profile",children:"Profile Settings"})}),(0,t.jsx)(c.DropdownMenuSeparator,{}),(0,t.jsxs)(c.DropdownMenuItem,{onClick:k,className:"text-destructive",children:[(0,t.jsx)(s.LogOut,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]}),(0,t.jsx)(N.RoleSwitcher,{})]})]})})}e.s(["WorkerNavHeader",()=>k],2436)},42220,e=>{"use strict";let t=(0,e.i(68385).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],42220)},56375,e=>{"use strict";let t=(0,e.i(68385).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],56375)},87176,e=>{"use strict";let t="civicflow_attendance_records";function a(){try{let e=localStorage.getItem(t);return e?JSON.parse(e):[]}catch{return[]}}function r(e){try{let r=a(),i=r.findIndex(t=>t.id===e.id);i>=0?r[i]=e:r.push(e),localStorage.setItem(t,JSON.stringify(r)),window.dispatchEvent(new CustomEvent("attendanceUpdated",{detail:{record:e}}))}catch(e){console.error("Failed to save attendance record:",e)}}function i(e){let t=a(),r=new Date().toDateString();return t.find(t=>t.worker_id===e&&new Date(t.date).toDateString()===r)||null}function n(e,t){let r=a().filter(t=>t.worker_id===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return t?r.slice(0,t):r}function s(e,t){let a=new Date(e);return Math.floor((new Date(t).getTime()-a.getTime())/6e4)}function o(e){let t=Math.floor(e/60);return`${t}h ${e%60}m`}function c(e){try{let t=JSON.parse(localStorage.getItem("civicflow_audit_logs")||"[]"),a={id:`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),action:"checked_in"===e.status?"WORKER_CHECK_IN":"WORKER_CHECK_OUT",user_id:e.worker_id,user_name:e.worker_name,user_role:"worker",details:{attendance_id:e.id,check_in_time:e.check_in_time,check_out_time:e.check_out_time,duration_minutes:e.duration_minutes,date:e.date},ip_address:"127.0.0.1",user_agent:navigator.userAgent};t.unshift(a),t.length>500&&t.splice(500),localStorage.setItem("civicflow_audit_logs",JSON.stringify(t)),window.dispatchEvent(new CustomEvent("auditLogUpdated"))}catch(e){console.error("Failed to add audit log:",e)}}async function l(e,t){try{let a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1`),r=await a.json();if(r.display_name)return r.display_name;return`${e.toFixed(4)}, ${t.toFixed(4)}`}catch(a){return console.error("Failed to get location name:",a),`${e.toFixed(4)}, ${t.toFixed(4)}`}}e.s(["addAttendanceAuditLog",()=>c,"calculateDuration",()=>s,"formatDuration",()=>o,"getLocationName",()=>l,"getTodayAttendance",()=>i,"getWorkerAttendanceHistory",()=>n,"saveAttendanceRecord",()=>r])},83886,e=>{"use strict";var t=e.i(51537),a=e.i(58987),r=e.i(2436),i=e.i(98121),n=e.i(80486),s=e.i(9704),o=e.i(9803),c=e.i(42220),l=e.i(56375),d=e.i(31161),m=e.i(42584),u=e.i(87176),h=e.i(14471);function x(){let[e,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[p,w]=(0,a.useState)([]),[j,N]=(0,a.useState)(null),[k,v]=(0,a.useState)(new Date),_=(0,h.getProfileFromStorage)(),y=_?.id||"worker_default",S=_?.full_name||"Worker";(0,a.useEffect)(()=>{C();let e=setInterval(()=>{v(new Date)},1e3),t=()=>C();return window.addEventListener("attendanceUpdated",t),()=>{clearInterval(e),window.removeEventListener("attendanceUpdated",t)}},[]);let C=()=>{let e=(0,u.getTodayAttendance)(y),t=(0,u.getWorkerAttendanceHistory)(y,10);f(e),w(t)},b=async()=>{x(!0),N(null);try{let e;if(navigator.geolocation)try{let t=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{timeout:1e4,enableHighAccuracy:!0})}),a=t.coords.latitude,r=t.coords.longitude,i=await (0,u.getLocationName)(a,r);e={latitude:a,longitude:r,locationName:i}}catch(e){console.log("[v0] Geolocation not available or denied")}let t=new Date,a={id:`attendance_${y}_${Date.now()}`,worker_id:y,worker_name:S,check_in_time:t.toISOString(),check_out_time:null,duration_minutes:null,date:t.toISOString(),location:e,status:"checked_in",created_at:t.toISOString(),updated_at:t.toISOString()};(0,u.saveAttendanceRecord)(a),(0,u.addAttendanceAuditLog)(a),f(a)}catch(e){N("उपस्थिति दर्ज करने में विफल / Failed to check in"),console.error("[v0] Check-in error:",e)}finally{x(!1)}},D=async()=>{if(g){x(!0),N(null);try{let e=new Date,t=(0,u.calculateDuration)(g.check_in_time,e.toISOString()),a={...g,check_out_time:e.toISOString(),duration_minutes:t,status:"checked_out",updated_at:e.toISOString()};(0,u.saveAttendanceRecord)(a),(0,u.addAttendanceAuditLog)(a),f(a)}catch(e){N("चेक आउट करने में विफल / Failed to check out"),console.error("[v0] Check-out error:",e)}finally{x(!1)}}},I=!g||g.check_out_time?null:(0,u.calculateDuration)(g.check_in_time,k.toISOString());return(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(r.WorkerNavHeader,{userName:S}),(0,t.jsx)("main",{className:"container px-4 md:px-6 py-8",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"उपस्थिति / Attendance"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Mark your check-in and check-out"})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{children:[(0,t.jsx)(i.CardTitle,{children:"आज की उपस्थिति / Today's Attendance"}),(0,t.jsx)(i.CardDescription,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Calendar,{className:"h-4 w-4"}),k.toLocaleDateString("hi-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})})]}),(0,t.jsxs)(i.CardContent,{className:"space-y-6",children:[g&&g.check_in_time&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-green-500/10 border border-green-500/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(c.CheckCircle,{className:"h-8 w-8 text-green-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-green-900 dark:text-green-100",children:"चेक इन किया / Checked In"}),(0,t.jsx)("p",{className:"text-sm text-green-700 dark:text-green-300",children:new Date(g.check_in_time).toLocaleTimeString("hi-IN")})]})]}),g.check_out_time&&(0,t.jsx)(s.Badge,{variant:"secondary",className:"bg-green-600 text-white",children:"Completed"})]}),null!==I&&(0,t.jsx)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-blue-500/10 border border-blue-500/20",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(o.Clock,{className:"h-8 w-8 text-blue-600 animate-pulse"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Active Session"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:(0,u.formatDuration)(I)})]})]})}),g.check_out_time&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(c.CheckCircle,{className:"h-8 w-8 text-muted-foreground"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"चेक आउट किया / Checked Out"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(g.check_out_time).toLocaleTimeString("hi-IN")})]})]}),g.duration_minutes&&(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Duration"}),(0,t.jsx)("p",{className:"text-lg font-bold",children:(0,u.formatDuration)(g.duration_minutes)})]})]}),g.location&&(0,t.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-muted/50 border",children:[(0,t.jsx)(m.MapPin,{className:"h-4 w-4 mt-0.5 text-primary"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Check-in Location"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:g.location.locationName||`${g.location.latitude.toFixed(6)}, ${g.location.longitude.toFixed(6)}`})]})]})]}),j&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-destructive/10 text-destructive text-sm",children:j}),(0,t.jsx)("div",{className:"flex gap-3",children:g&&g.check_in_time?g.check_out_time?(0,t.jsx)("div",{className:"flex-1 p-4 rounded-lg bg-green-500/10 text-green-700 dark:text-green-400 text-center font-medium border border-green-500/20",children:"✓ आज की उपस्थिति दर्ज / Attendance marked for today"}):(0,t.jsx)(n.Button,{onClick:D,disabled:e,className:"flex-1",size:"lg",variant:"destructive",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),"चेक आउट हो रहा है..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Clock,{className:"mr-2 h-5 w-5"}),"चेक आउट करें / Check Out"]})}):(0,t.jsx)(n.Button,{onClick:b,disabled:e,className:"flex-1",size:"lg",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),"चेक इन हो रहा है..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Clock,{className:"mr-2 h-5 w-5"}),"चेक इन करें / Check In"]})})}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Location name will be captured automatically when available"})]})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{children:[(0,t.jsx)(i.CardTitle,{children:"उपस्थिति इतिहास / Attendance History"}),(0,t.jsx)(i.CardDescription,{children:"Your recent check-ins and check-outs"})]}),(0,t.jsx)(i.CardContent,{children:0===p.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)(o.Clock,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No attendance records yet"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Check in to start tracking your attendance"})]}):(0,t.jsx)("div",{className:"space-y-4",children:p.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(d.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("p",{className:"font-medium",children:new Date(e.date).toLocaleDateString("hi-IN",{weekday:"short",day:"numeric",month:"short",year:"numeric"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.Clock,{className:"h-3 w-3"}),"In: ",new Date(e.check_in_time).toLocaleTimeString("hi-IN")]}),e.check_out_time&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"→"}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.Clock,{className:"h-3 w-3"}),"Out: ",new Date(e.check_out_time).toLocaleTimeString("hi-IN")]})]})]}),e.location?.locationName&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[(0,t.jsx)(m.MapPin,{className:"h-3 w-3"}),e.location.locationName]}),e.duration_minutes&&(0,t.jsxs)("p",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 mt-1",children:["Duration: ",(0,u.formatDuration)(e.duration_minutes)]})]}),(0,t.jsx)("div",{children:e.check_out_time?(0,t.jsx)(s.Badge,{variant:"secondary",className:"bg-green-500/10 text-green-700",children:"पूर्ण / Complete"}):(0,t.jsx)(s.Badge,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-700",children:"प्रगति में / In Progress"})})]},e.id))})})]})]})})]})}e.s(["default",()=>x])}]);